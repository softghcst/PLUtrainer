<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>H-Mart PLU Trainer</title>
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icons/icon-180.png">
<meta name="theme-color" content="#E6002D">
<meta name="apple-mobile-web-app-title" content="H-Mart PLU Trainer">
<style>
:root{
  --bg:#0b0f19;
  --fg:#e9eef9;
  --card:#0f1422;
  --muted:#9fb0d1;
  --accent:#E6002D; /* H-Mart red */
}
body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
header{position:sticky;top:0;z-index:9;display:flex;gap:8px;align-items:center;padding:10px 12px;border-bottom:1px solid #202737;background:var(--card)}
h1{font-size:1.1rem;margin:0} .muted{color:var(--muted)} .small{font-size:.9rem}
main{display:grid;grid-template-columns:1fr;gap:10px;padding:10px}
.card{background:#0e1320;border:1px solid #1e2636;border-radius:14px;padding:10px}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.btn{background:#111927;border:1px solid #273145;color:#e4ecfa;border-radius:10px;padding:8px 10px;cursor:pointer}
.btn.green{background:#0f3120;border-color:#1e7448}
.pill{display:inline-flex;gap:6px;align-items:center;border:1px solid #26314a;background:#0e121c;padding:6px 10px;border-radius:999px}
input,select{background:#0e1320;border:1px solid #26314a;color:#fff;border-radius:8px;padding:8px}
code,.code{font-family:ui-monospace,Menlo,Consolas,monospace;background:#0b0f19;border:1px solid #26314a;border-radius:6px;padding:2px 6px}
.table{width:100%;border-collapse:collapse} .table th,.table td{border-bottom:1px solid #22304a;padding:6px 8px;text-align:left}
.ok{color:#3bd17f} .bad{color:#ff6b6b}
.imgbox{width:120px;height:120px;background:#0d1220;border:1px solid #22304a;border-radius:10px;display:flex;align-items:center;justify-content:center;overflow:hidden}
.imgbox img{max-width:100%;max-height:100%;display:block}

/* Bottom tabs */
.tabs{position:sticky;bottom:0;left:0;right:0;background:var(--card);border-top:1px solid #202737;display:flex;gap:6px;padding:6px;justify-content:space-around;z-index:10}
.tabbtn{flex:1;text-align:center;padding:8px;border-radius:8px;border:1px solid #2a3345;background:#111522;color:#cfd6e6;font-size:.8rem}
.tabbtn.active{background:var(--accent);border-color:#b00020;color:#fff}
.panel{display:none}
.panel.active{display:block}

.list{max-height:60vh;overflow:auto;border:1px solid #22304a;border-radius:10px}
.list .rowline{display:flex;gap:10px;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid #22304a}
.chip{display:inline-flex;align-items:center;padding:3px 8px;border-radius:999px;border:1px solid #2a3345;background:#0e121c;font-size:.8rem;color:#cfd6e6}
  /* SRS Badge colors */
#srsBadge {
  padding: 1px 6px;
  border-radius: 6px;
}
#srsBadge.ON {
  background: #0f3120;
  color: #3bd17f;
  font-weight: 700;
}
#srsBadge.OFF {
  background: #2a2f3a;
  color: #9fb0d1;
}
  /* Light theme variants for the SRS badge */
.light #srsBadge.ON {
  background: #e8f7ee;   /* pale green */
  color: #147a3a;        /* deep green text */
}
.light #srsBadge.OFF {
  background: #eef1f6;   /* pale gray-blue */
  color: #6b7a93;        /* muted label */
}
.star{cursor:pointer;font-size:1.1rem}
.bigpad{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
.bigkey{padding:20px;border-radius:14px;text-align:center;background:#121723;border:1px solid #2a3345;font-size:1.6rem;font-weight:900}
.bigkey.big{grid-column:span 3}

/* Light theme */
.light{
  --bg:#f2f3f7;   /* light gray background */
  --fg:#0b0f19;
  --card:#ffffff; /* cards stay white */
  --muted:#44516b;
}

/* Light theme contrast fixes */
.light body{ background:#f2f3f7; }
.light .card{ 
  background:#ffffff; 
  border-color:#d9dee8; 
  box-shadow:0 1px 3px rgba(0,0,0,0.05);
}
.light .list{ border-color:#d9dee8; }
.light .list .rowline{ border-bottom-color:#e1e6f0; }
.light input,.light select{ background:#ffffff; color:#0b0f19; border-color:#d6dbe7; }
.light .pill{ background:#f7f8fb; border-color:#d9dee8; }
.light .bigkey{ background:#f9f9fc; border-color:#d9dee8; }
.light .imgbox{ background:#f7f8fb; border-color:#d9dee8; }
.light header{ background:#ffffff; border-bottom-color:#d9dee8; }
  /* === Checkout visuals (customer + conveyor belt) === */
.checkout-area{
  display:flex; align-items:center; gap:12px;
  padding:10px; border:1px solid #22304a; border-radius:12px;
  background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.05));
}
.avatar{ width:72px; height:72px; border-radius:12px; overflow:hidden; border:1px solid #22304a; background:#0e121c; flex:0 0 auto; }
.avatar img{ width:100%; height:100%; object-fit:cover; display:block; }

.belt{
  position:relative; flex:1; height:80px; border-radius:10px; overflow:hidden;
  border:1px solid #22304a; background:#0f1422;
}
.belt::before{
  content:""; position:absolute; inset:0;
  background: repeating-linear-gradient(
    -45deg,
    rgba(255,255,255,.04) 0 12px,
    rgba(255,255,255,.02) 12px 24px
  );
  animation: beltMove 2.8s linear infinite;
  pointer-events:none;
}
@keyframes beltMove{ 0%{ transform: translateX(0) } 100%{ transform: translateX(-48px) } }

#beltItems{ position:absolute; inset:0; }
.belt-item{
  position:absolute; bottom:10px; width:58px; height:58px;
  display:flex; align-items:center; justify-content:center;
  background:#121723; border:1px solid #2a3345; border-radius:10px;
  box-shadow: 0 2px 6px rgba(0,0,0,.25);
  font-size:30px; user-select:none;
  animation: slideAcross 6s linear infinite;
}
.belt-item .hint{
  position:absolute; top:-18px; left:50%; transform:translateX(-50%);
  font-size:.70rem; color:#9fb0d1;
  background:rgba(0,0,0,.35); padding:2px 6px; border-radius:6px;
  border:1px solid #22304a;
}
@keyframes slideAcross{
  0%   { transform:translateX(110%); opacity:.0 }
  10%  { opacity:1 }
  90%  { opacity:1 }
  100% { transform:translateX(-120%); opacity:.0 }
}

/* light theme tweaks for belt */
.light .checkout-area{ border-color:#e4e9f3; background:#f8f9fc; }
.light .avatar{ background:#fff; border-color:#e4e9f3; }
.light .belt{ background:#fff; border-color:#e6ebf5; }
.light .belt::before{
  background: repeating-linear-gradient(
    -45deg,
    rgba(0,0,0,.04) 0 12px,
    rgba(0,0,0,.02) 12px 24px
  );
}
.light .belt-item{ background:#f4f6fb; border-color:#e1e6f0; }
.light .belt-item .hint{ background:#eef1f6; border-color:#dfe6f2; color:#6b7a93; }
/* === H-MART branding bits === */
.brand{
  display:flex; align-items:center; gap:10px; margin:0;
  font-size:1.1rem; letter-spacing:.2px;
}
.hmart-badge{
  display:inline-flex; align-items:center; justify-content:center;
  padding:0 10px;
  height:28px;
  border-radius:4px;
  background:#E6002D;
  color:#fff;
  font-weight:900;
  font-size:.9rem;
  font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  line-height:1;
  box-shadow:0 1px 0 rgba(0,0,0,.25) inset, 0 2px 6px rgba(0,0,0,.25);
  text-transform:uppercase;
}
/* optional: make any "red" buttons match the brand red */
.btn.red{ background:var(--accent); border-color:#b00020 }
</style>
</head>
<body>
<header>
  <h1 class="brand">
    <span class="hmart-badge">H-Mart</span> PLU Trainer
  </h1>
  <div class="row" style="margin-left:auto;flex-wrap:wrap;gap:8px">
    <button class="btn" id="themeToggle">üåô/‚òÄÔ∏è</button>
    <button class="btn" id="settingsBtn">‚öôÔ∏è</button>

    <label class="chip">
      <input type="checkbox" id="fxHaptics" checked> Haptics
    </label>

    <label class="chip">
      <input type="checkbox" id="fxSound"> Sound
    </label>

    <label class="chip">
      <input type="checkbox" id="srsMode"> SRS
      <span id="srsBadge" class="OFF">OFF</span>
    </label>
  </div>
</header>
<main>
  <!-- Learn -->
  <section id="panelLearn" class="panel active">
    <div class="card">
      <h2>Learn ‚Äî Guided</h2>
      <div class="row">
        <div class="imgbox"><img id="learnImg" style="display:none"><span class="muted small" id="learnNoImg">No picture</span></div>
        <div style="flex:1">
          <div><b id="learnName">‚Äî</b> <span class="muted">(<span id="learnCat">‚Äî</span>)</span></div>
          <div class="small muted" id="learnNotes"></div>
          <div class="row" style="margin-top:8px">
            <button class="btn" id="learnPrev">‚óÄ Prev</button>
            <button class="btn" id="learnNext">Next ‚ñ∂</button>
            <button class="btn" id="learnShow">Show Code</button>
            <span class="pill code" id="learnCode" style="display:none"></span>
            <button class="btn" id="learnPic">Add Picture</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Quiz -->
  <section id="panelQuiz" class="panel">
    <div class="card">
      <h2>Quiz ‚Äî Register</h2>
<div class="row" style="margin:6px 0">
  <div class="chip">Current: <b id="qName">‚Äî</b> <span class="muted">(<span id="qCat">‚Äî</span>)</span></div>
  <div class="chip">Target length: <b id="qLen">‚Äî</b></div>
  <div class="chip">Due: <b id="dueCount">0</b></div>
  <div class="chip">SRS: <b id="srsBadge">OFF</b></div>
</div>
      <div class="row">
        <input id="qInput" inputmode="numeric" placeholder="Enter PLU‚Ä¶" maxlength="5">
        <button class="btn" id="qSubmit">Enter</button>
        <button class="btn" id="qNext">Next ‚ñ∂</button>
      </div>
      <div id="qFeedback" class="small" style="margin-top:6px"></div>
    </div>
  </section>

<!-- Checkout -->
<section id="panelCheckout" class="panel">
  <div class="card">
    <h2>Checkout Game ‚Äî Simulated Register</h2>

    <div class="row">
      <button class="btn green" id="cgStart">Start</button>
      <select id="cgPreset">
        <option value="rookie">Rookie</option>
        <option value="cashier" selected>Cashier</option>
        <option value="speed">Speed</option>
        <option value="expert">Expert</option>
      </select>
      <select id="cgTimer">
        <option value="0">Timer Off</option>
        <option value="30">30s</option>
        <option value="20">20s</option>
        <option value="10">10s</option>
        <option value="5">5s</option>
      </select>
    </div>

    <label class="chip" style="margin-top:6px">
      <input type="checkbox" id="showCatHint"> Show Category Hint (next item)
    </label>

    <!-- Visuals: avatar + conveyor belt -->
    <div id="checkoutVisuals" class="checkout-area" style="margin-top:8px">
      <div id="customerAvatar" class="avatar"></div>
      <div class="belt">
        <div id="beltItems"></div>
      </div>
    </div>

    <div class="row" style="margin-top:6px">
      <div class="chip">Customer <b id="cgCust">0</b>/<b id="cgCustTotal">0</b></div>
      <div class="chip">Items <b id="cgItem">0</b>/<b id="cgItemTotal">0</b></div>
      <div class="chip">Streak <b id="cgStreak">0</b></div>
    </div>

    <div class="row" style="margin:8px 0">
      <div class="imgbox"><img id="cgImg" style="display:none"><span class="muted small" id="cgNoImg">No picture</span></div>
      <div style="flex:1">
        <div><b id="cgName">‚Äî</b> <span class="muted">(<span id="cgCat">‚Äî</span>)</span></div>
        <div class="row" style="margin-top:8px">
          <input id="cgInput" inputmode="numeric" placeholder="Enter PLU‚Ä¶" maxlength="5">
          <button class="btn" id="cgEnter">Enter</button>
          <button class="btn" id="cgSkip">Skip</button>
        </div>
        <div id="cgFeedback" class="small" style="margin-top:6px"></div>
      </div>
    </div>
  </div>
</section>

  <!-- Big keypad tab -->
  <section id="panelKeypad" class="panel">
    <div class="card">
      <h2>Big Keypad</h2>
      <div class="bigpad">
        <div class="bigkey">1</div><div class="bigkey">2</div><div class="bigkey">3</div>
        <div class="bigkey">4</div><div class="bigkey">5</div><div class="bigkey">6</div>
        <div class="bigkey">7</div><div class="bigkey">8</div><div class="bigkey">9</div>
        <div class="bigkey">0</div>
        <div class="bigkey big" id="bkEnter">Enter</div>
        <div class="bigkey big" id="bkClear">Clear</div>
      </div>
      <div class="row" style="margin-top:8px">
        <input id="bkInput" inputmode="numeric" placeholder="Enter PLU‚Ä¶" maxlength="5">
      </div>
      <div id="bkFeedback" class="small" style="margin-top:6px"></div>
    </div>
  </section>

  <!-- Stats tab -->
<section id="panelStats" class="panel">
  <div class="card">
    <h2>Stats</h2>
    <div id="stats"></div>
    <div class="row" style="margin-top:10px; gap:8px">
      <button class="btn" id="exportData">üíæ Save Backup</button>
      <button class="btn" id="shareStats">üì§ Share Stats</button>
    </div>
  </div>
</section>
</main>

<!-- Bottom tabs -->
<nav class="tabs">
  <button class="tabbtn active" data-tab="panelLearn">Learn</button>
  <button class="tabbtn" data-tab="panelQuiz">Quiz</button>
  <button class="tabbtn" data-tab="panelCheckout">Checkout</button>
  <button class="tabbtn" data-tab="panelBrowse">Browse</button>
  <button class="tabbtn" data-tab="panelKeypad">Keypad</button>
  <button class="tabbtn" data-tab="panelStats">Stats</button>
</nav>

<!-- üîΩüîΩüîΩ PASTE your full master JSON here (the entire array) and save -->
<script id="seed" type="application/json">[
  {"name":"Cosmic Crisp Apple","code":"2773","category":"Apple","notes":""},
  {"name":"Gala Apple","code":"2781","category":"Apple","notes":""},
  {"name":"Fuji Apple","code":"2782","category":"Apple","notes":""},
  {"name":"Fuji Apple (Organic)","code":"27829","category":"Apple","notes":"Organic ‚Üí 9 at end"},
  {"name":"Red Delicious Apple","code":"2784","category":"Apple","notes":""},
  {"name":"Golden Delicious Apple","code":"2785","category":"Apple","notes":""},
  {"name":"Granny Smith Apple","code":"2788","category":"Apple","notes":""},
  {"name":"Envy Apple","code":"2792","category":"Apple","notes":""},
  {"name":"Honey Crisp Apple","code":"2794","category":"Apple","notes":""},
  {"name":"Pink Lady Apple","code":"2795","category":"Apple","notes":""},
  {"name":"Sugarbee Apple","code":"2807","category":"Apple","notes":""},

  {"name":"Asian Pear","code":"2725","category":"Pear","notes":""},
  {"name":"Yali Pear","code":"2726","category":"Pear","notes":""},
  {"name":"Fragrant Pear","code":"2727","category":"Pear","notes":""},
  {"name":"Korean Pear","code":"2728","category":"Pear","notes":""},
  {"name":"Korean Golden Pear","code":"2729","category":"Pear","notes":""},
  {"name":"Bosc Pear","code":"2731","category":"Pear","notes":""},
  {"name":"D‚ÄôAnjuor Pear","code":"2732","category":"Pear","notes":""},
  {"name":"Bartlett Pear","code":"2733","category":"Pear","notes":""},
  {"name":"Red D‚ÄôAnjour","code":"2741","category":"Pear","notes":""},
  {"name":"Sand Pear","code":"2744","category":"Pear","notes":""},
  {"name":"Apple Pear","code":"2746","category":"Pear","notes":""},

  {"name":"Korean Melon","code":"2670","category":"Melon","notes":""},
  {"name":"Hami Melon","code":"2671","category":"Melon","notes":""},
  {"name":"Tuscan Melon","code":"2687","category":"Melon","notes":""},
  {"name":"Cantaloupe","code":"2685","category":"Melon","notes":""},

  {"name":"Watermelon","code":"2811","category":"Watermelon","notes":""},

  {"name":"Fuyu Persimmon","code":"2651","category":"Persimmon","notes":""},
  {"name":"Quince","code":"2700","category":"Quince","notes":""},

  {"name":"Apple Banana","code":"2709","category":"Banana","notes":""},
  {"name":"Red Banana","code":"2710","category":"Banana","notes":""},
  {"name":"Yellow Banana","code":"2711","category":"Banana","notes":""},
  {"name":"Baby Banana","code":"2712","category":"Banana","notes":""},
  {"name":"Thai Banana","code":"2715","category":"Banana","notes":""},
  {"name":"Burro Banana","code":"2716","category":"Banana","notes":""},
  {"name":"Green Banana","code":"2718","category":"Banana","notes":""},

  {"name":"Green Plantain","code":"2719","category":"Plantain","notes":""},
  {"name":"Yellow Plantain","code":"2720","category":"Plantain","notes":""},

  {"name":"White Peach","code":"2760","category":"Peach","notes":""},
  {"name":"Yellow Peach","code":"2761","category":"Peach","notes":""},
  {"name":"White Donut Peach","code":"2763","category":"Peach","notes":""},
  {"name":"Yellow Nectarine","code":"2767","category":"Nectarine","notes":""},
  {"name":"White Nectarine","code":"2769","category":"Nectarine","notes":""},

  {"name":"Avocado Hass","code":"2839","category":"Avocado","notes":""},
  {"name":"Organic Avocado Hass","code":"28399","category":"Avocado","notes":"Organic ‚Üí 9 at end"},

  {"name":"Cacao Fruit","code":"2845","category":"Tropical Fruit","notes":""},
  {"name":"Mango","code":"2847","category":"Mango","notes":""},
  {"name":"Green Mango","code":"2850","category":"Mango","notes":""},
  {"name":"Mango Box","code":"28473","category":"Mango","notes":"Box code"},

  {"name":"White Coconut","code":"2857","category":"Coconut","notes":""},
  {"name":"Brown Coconut","code":"2858","category":"Coconut","notes":""},
  {"name":"Green Coconut","code":"2859","category":"Coconut","notes":""},

  {"name":"Papaya","code":"2862","category":"Papaya","notes":""},
  {"name":"Hawaiian Papaya","code":"2863","category":"Papaya","notes":""},
  {"name":"Green Papaya","code":"2864","category":"Papaya","notes":""},

  {"name":"Pomegranate","code":"2808","category":"Pomegranate","notes":""},

  {"name":"Fresh Durian","code":"2870","category":"Tropical Fruit","notes":""},
  {"name":"Frozen Durian","code":"28708","category":"Tropical Fruit","notes":""},
  {"name":"Sapote (Mamey)","code":"2872","category":"Tropical Fruit","notes":""},
  {"name":"Dragon Fruit White Flesh","code":"2874","category":"Tropical Fruit","notes":""},
  {"name":"Longan","code":"2875","category":"Tropical Fruit","notes":""},
  {"name":"Soursop","code":"2876","category":"Tropical Fruit","notes":""},
  {"name":"Rambutan","code":"2877","category":"Tropical Fruit","notes":""},
  {"name":"Guava","code":"2878","category":"Tropical Fruit","notes":""},
  {"name":"Cherimoya","code":"2879","category":"Tropical Fruit","notes":""},
  {"name":"Mangosteen","code":"2880","category":"Tropical Fruit","notes":""},
  {"name":"Breadfruit","code":"2881","category":"Tropical Fruit","notes":""},
  {"name":"Yellow Dragon Fruit","code":"2883","category":"Tropical Fruit","notes":""},

  {"name":"Pineapple","code":"2868","category":"Pineapple","notes":""},

  {"name":"Sweet Lime","code":"2886","category":"Citrus","notes":""},
  {"name":"Lime","code":"2887","category":"Citrus","notes":""},
  {"name":"Lemon","code":"2888","category":"Citrus","notes":""},

  {"name":"Korean Hallabong","code":"2884","category":"Orange","notes":""},
  {"name":"Navel Orange","code":"2889","category":"Orange","notes":""},
  {"name":"Cara Cara Orange","code":"2896","category":"Orange","notes":""},
  {"name":"Minneola Orange","code":"2898","category":"Orange","notes":""},
  {"name":"Blood Orange","code":"2899","category":"Orange","notes":""},
  {"name":"Orri Mandarin","code":"2900","category":"Mandarin","notes":""},
  {"name":"Sour Orange","code":"2912","category":"Orange","notes":""},

  {"name":"Yellow Plum","code":"2919","category":"Plum","notes":""},
  {"name":"Red Plum","code":"2921","category":"Plum","notes":""},
  {"name":"Dinosaur Plum","code":"2922","category":"Plum","notes":""},

  {"name":"Pink Grapefruit","code":"2948","category":"Grapefruit","notes":""},

  {"name":"Florida Pomelo","code":"2953","category":"Pomelo","notes":""},
  {"name":"Chinese Pomelo","code":"2954","category":"Pomelo","notes":""},
  {"name":"Pomelo","code":"2955","category":"Pomelo","notes":""},

  {"name":"Cotton Candy Grape","code":"2969","category":"Grape","notes":""},
  {"name":"Green Seedless Grape","code":"2971","category":"Grape","notes":""},
  {"name":"Red Seedless Grape","code":"2972","category":"Grape","notes":""},

  {"name":"Plain Parsley","code":"2349","category":"Herbs","notes":""},
  {"name":"Cilantro","code":"2350","category":"Herbs","notes":""},
  {"name":"Curly Parsley","code":"2351","category":"Herbs","notes":""},

  {"name":"Gray Squash","code":"2411","category":"Squash","notes":""},
  {"name":"Korean Squash","code":"2412","category":"Squash","notes":""},
  {"name":"Kabocha","code":"2418","category":"Squash","notes":""},
  {"name":"Calabaza","code":"2419","category":"Squash","notes":""},
  {"name":"Spaghetti Squash","code":"2421","category":"Squash","notes":""},
  {"name":"Butternut Squash","code":"2423","category":"Squash","notes":""},
  {"name":"Acorn Squash","code":"2424","category":"Squash","notes":""},

  {"name":"Watercress","code":"2455","category":"Leafy Greens","notes":""},
  {"name":"Turnip Green","code":"2456","category":"Leafy Greens","notes":""},
  {"name":"Leek","code":"2458","category":"Leafy Greens","notes":""},
  {"name":"Dill","code":"2464","category":"Herbs","notes":""},
  {"name":"Radicchio","code":"2509","category":"Leafy Greens","notes":""},
  {"name":"Red Beet Bunch","code":"2472","category":"Root Vegetable","notes":""},
  {"name":"Red Beet","code":"2473","category":"Root Vegetable","notes":""},

  {"name":"Kale","code":"2490","category":"Leafy Greens","notes":""},
  {"name":"Curly Kale","code":"2491","category":"Leafy Greens","notes":""},
  {"name":"White Turnip","code":"2495","category":"Root Vegetable","notes":""},
  {"name":"Green Onion","code":"2498","category":"Onion","notes":""},

  {"name":"White Garlic","code":"2525","category":"Garlic","notes":""},
  {"name":"Ginger","code":"2530","category":"Root Vegetable","notes":""},

  {"name":"White Onion","code":"2538","category":"Onion","notes":""},
  {"name":"Red Onion","code":"2539","category":"Onion","notes":""},
  {"name":"Yellow Onion","code":"2540","category":"Onion","notes":""},
  {"name":"Shallot Onion","code":"2547","category":"Onion","notes":""},

  {"name":"Potato","code":"2557","category":"Potato","notes":""},
  {"name":"Red Potato","code":"2558","category":"Potato","notes":""},
  {"name":"White Potato","code":"2559","category":"Potato","notes":""},

  {"name":"American Yam","code":"2560","category":"Yam","notes":""},
  {"name":"Korean Sweet Potato","code":"2565","category":"Yam","notes":""},
  {"name":"Korean Sweet Potato Box","code":"25656","category":"Yam","notes":"Box code"},

  {"name":"Yucca","code":"2581","category":"Root Vegetable","notes":""},
  {"name":"Jicama","code":"2582","category":"Root Vegetable","notes":""},
  {"name":"Yellow Yam","code":"2584","category":"Yam","notes":""},
  {"name":"White Yam","code":"2585","category":"Yam","notes":""},
  {"name":"Batata","code":"2586","category":"Yam","notes":""},
  {"name":"Yautia","code":"2587","category":"Yam","notes":""},
  {"name":"Yampi","code":"2590","category":"Yam","notes":""},
  {"name":"Hawaiian Purple Yam","code":"2591","category":"Yam","notes":""},

  {"name":"Small Taro (Eddo)","code":"2593","category":"Root Vegetable","notes":""},
  {"name":"Big Taro (Malanga)","code":"2594","category":"Root Vegetable","notes":""},
  {"name":"Name Yam","code":"2595","category":"Yam","notes":""},
  {"name":"Malanga Blanca","code":"2596","category":"Root Vegetable","notes":""},

  {"name":"Pandan Leaf","code":"2410","category":"Herbs / Aromatics","notes":""},

  {"name":"Banana Flower","code":"2713","category":"Flowers / Special Veggies","notes":""},
  {"name":"Okra","code":"2075","category":"Pods","notes":""},
  {"name":"Chinese Okra","code":"2076","category":"Pods","notes":""},

  {"name":"Holland Red Pepper","code":"2122","category":"Pepper","notes":""},
  {"name":"Holland Yellow Pepper","code":"2123","category":"Pepper","notes":""},
  {"name":"Holland Green Pepper","code":"2124","category":"Pepper","notes":""},
  {"name":"Holland Orange Pepper","code":"2125","category":"Pepper","notes":""},

  {"name":"Carrot","code":"2163","category":"Root Vegetable","notes":""},
  {"name":"Jujube","code":"2173","category":"Fruit","notes":""},
  {"name":"Korean Radish","code":"2175","category":"Root Vegetable","notes":""},
  {"name":"Daikon Radish (Chinese)","code":"2179","category":"Root Vegetable","notes":""},

  {"name":"Napa Cabbage","code":"2195","category":"Cabbage","notes":""},
  {"name":"Chinese Chives","code":"2221","category":"Herbs / Aromatics","notes":""},

  {"name":"Broccoli","code":"2231","category":"Brassica","notes":""},
  {"name":"White Cauliflower","code":"2234","category":"Brassica","notes":""},
  {"name":"Purple Cauliflower","code":"2235","category":"Brassica","notes":""},
  {"name":"Chinese Cauliflower","code":"2239","category":"Brassica","notes":""},

  {"name":"Red Leaf Lettuce","code":"2242","category":"Lettuce","notes":""},
  {"name":"Green Leaf Lettuce","code":"2243","category":"Lettuce","notes":""},
  {"name":"Romaine Lettuce","code":"2245","category":"Lettuce","notes":""},

  {"name":"Celery","code":"2252","category":"Stalks","notes":""},

  {"name":"Asparagus","code":"2262","category":"Asparagus","notes":""},
  {"name":"White Asparagus","code":"2263","category":"Asparagus","notes":""},
  {"name":"Purple Asparagus","code":"2264","category":"Asparagus","notes":""},

  {"name":"Green Cabbage","code":"2268","category":"Cabbage","notes":""},
  {"name":"White Cabbage","code":"2269","category":"Cabbage","notes":""},
  {"name":"Savoy Cabbage","code":"2271","category":"Cabbage","notes":""},

  {"name":"Yellow Corn","code":"2285","category":"Corn","notes":""},
  {"name":"Chayote","code":"2294","category":"Chayote","notes":""},

  {"name":"Green Bean","code":"2308","category":"Beans","notes":""},
  {"name":"Flat Bean","code":"2310","category":"Beans","notes":""},

  {"name":"Tomatoes","code":"2325","category":"Tomato","notes":""},
  {"name":"Plum Tomatoes","code":"2326","category":"Tomato","notes":""},
  {"name":"Stem Tomatoes","code":"2327","category":"Tomato","notes":""},
  {"name":"Beef Tomato","code":"2328","category":"Tomato","notes":""},
  {"name":"Parsnip Root","code":"2346","category":"Root Vegetable","notes":""},
  {"name":"Stem Tomato Box","code":"23273","category":"Tomato","notes":"Box code"}
]</script>
<!-- üîºüîºüîº End master list embed -->

<script>
// ---------------- Utilities & State ----------------
const $ = s=>document.querySelector(s);
const $$ = s=>[...document.querySelectorAll(s)];
const store = {
  save(k,v){ localStorage.setItem(k, JSON.stringify(v)); },
  get(k,f){ try{ return JSON.parse(localStorage.getItem(k)) ?? f } catch{ return f } },
  del(k){ localStorage.removeItem(k) }
};
  // Format helpers for numbers, percentages, and pretty stats text
function fmt(n){ return Number(n||0).toLocaleString(); }
function accuracyPct(stats){
  return stats.seen ? Math.round(100 * stats.correct / stats.seen) : 0;
}
function prettyStatsText(){
  const acc = accuracyPct(STATS);
  const lines = [
    "PLU Trainer ‚Äî Current Stats",
    `‚Ä¢ Seen: ${fmt(STATS.seen)}`,
    `‚Ä¢ Correct: ${fmt(STATS.correct)}`,
    `‚Ä¢ Accuracy: ${acc}%`,
    `‚Ä¢ Current Streak: ${fmt(STATS.streak)}`,
    `‚Ä¢ Best Streak: ${fmt(STATS.bestStreak)}`,
    `‚Ä¢ Timestamp: ${new Date().toLocaleString()}`
  ];
  return lines.join("\n");
}
// --- Feedback (Haptics + Sound) ---
function giveFeedback(type="light") {
  // Haptics (vibration if supported)
  if ($("#fxHaptics")?.checked && navigator.vibrate) {
    if (type === "success") navigator.vibrate([30]);
    else if (type === "error") navigator.vibrate([60, 40, 60]);
    else navigator.vibrate(20);
  }

  // Optional click sound
  if ($("#fxSound")?.checked) {
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.type = "square";
    osc.frequency.value = (type === "success") ? 880 : (type === "error" ? 220 : 440);
    osc.connect(gain);
    gain.connect(ctx.destination);
    osc.start();
    gain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.15);
    osc.stop(ctx.currentTime + 0.15);
  }
}
// Title Case (preserves internal apostrophes like D‚ÄôAnjou)
function toTitle(s){
  return s.toLowerCase().replace(/([\p{L}\p{N}]+)/gu, w=>{
    return w.charAt(0).toUpperCase()+w.slice(1);
  }).replace(/\bD‚Äôanjou\b/giu,'D‚ÄôAnjou').replace(/\bD‚Äôanjour\b/giu,'D‚ÄôAnjour');
}

// Load DATA: prefer localStorage overrides; else embed seed
let DATA = store.get('DATA_BAKED', null);
if(!DATA){
  const raw = $("#seed").textContent.trim();
  DATA = JSON.parse(raw);
  // Normalize names/categories for display/search
  DATA = DATA.map(x=>({
    ...x,
    name: toTitle(String(x.name || "")),
    code: String(x.code || ""),
    category: toTitle(String(x.category || "")),
    notes: x.notes || "",
    image: x.image || ""
  }));
  store.save('DATA_BAKED', DATA);
}

// --- Item count helper (MUST exist whether DATA came from localStorage or seed)
const TOTAL_ITEMS = DATA.length;
function updateItemCount(filteredCount = TOTAL_ITEMS){
  const c = document.getElementById('itemCount');
  if (c) c.textContent = `(${filteredCount}/${TOTAL_ITEMS})`;
}

// Favorites & performance
const FAV = new Set(store.get('FAV', []));
function saveFav(){ store.save('FAV', [...FAV]); }
const STATS = store.get('STATS', {seen:0,correct:0,streak:0,bestStreak:0});
function saveStats(){ store.save('STATS', STATS); }

// Theme
$("#themeToggle").onclick = ()=>{
  document.body.classList.toggle('light');
  localStorage.setItem('THEME', document.body.classList.contains('light') ? 'light':'dark');
};
if(localStorage.getItem('THEME')==='light') document.body.classList.add('light');

// --------------- Tabs ----------------
$$('.tabbtn').forEach(b=>b.onclick=()=>{
  $$('.tabbtn').forEach(x=>x.classList.remove('active'));
  b.classList.add('active');
  $$('.panel').forEach(p=>p.classList.remove('active'));
  $('#'+b.dataset.tab).classList.add('active');
});

// --------------- Learn ----------------
let idx=0;
function showLearn(){
  const it = DATA[idx % DATA.length];
  $("#learnName").textContent = it.name;
  $("#learnCat").textContent = it.category;
  $("#learnNotes").textContent = it.notes || '';
  $("#learnCode").style.display='none';
  if(it.image){ $("#learnImg").src = it.image; $("#learnImg").style.display='block'; $("#learnNoImg").style.display='none'; }
  else { $("#learnImg").style.display='none'; $("#learnNoImg").style.display='inline'; }
}
$("#learnPrev").onclick = ()=>{ idx=(idx-1+DATA.length)%DATA.length; showLearn(); };
$("#learnNext").onclick = ()=>{ idx=(idx+1)%DATA.length; showLearn(); };
$("#learnShow").onclick = ()=>{ $("#learnCode").textContent = DATA[idx].code; $("#learnCode").style.display='inline-block'; };
$("#learnPic").onclick = ()=>{
  const url = prompt("Paste image URL for: "+DATA[idx].name);
  if(!url) return;
  DATA[idx].image = url;
  store.save('DATA_BAKED', DATA);
  showLearn();
};
showLearn();
  // --------- Spaced Repetition (SRS) ----------
const SRS = store.get('SRS', {}); // keyed by code -> {ef, reps, intervalDays, dueTs}
function saveSRS(){ store.save('SRS', SRS); }
function nowTs(){ return Date.now(); }
function days(n){ return n*24*60*60*1000; }

// Get/create record for a code
function srsGet(code){
  if(!SRS[code]) SRS[code] = { ef:2.5, reps:0, intervalDays:0, dueTs: nowTs() }; // due now
  return SRS[code];
}

// SM-2 inspired, simplified:
// - correct: reps+1; interval: 1d, then 6d, then round(prev*ef); ef += 0.1 (cap 2.8)
// - wrong:   reps=0;  interval=1d; ef -= 0.3 (floor 1.3)
function srsUpdate(code, correct){
  const r = srsGet(code);
  if(correct){
    r.reps += 1;
    if(r.reps === 1) r.intervalDays = 1;
    else if(r.reps === 2) r.intervalDays = 6;
    else r.intervalDays = Math.round(Math.max(1, r.intervalDays * r.ef));
    r.ef = Math.min(2.8, r.ef + 0.1);
  } else {
    r.reps = 0;
    r.intervalDays = 1;
    r.ef = Math.max(1.3, r.ef - 0.3);
  }
  r.dueTs = nowTs() + days(r.intervalDays);
  saveSRS();
}

// All items that are due now (or overdue)
function srsDueItems(){
  const t = nowTs();
  const due = [];
  for(const it of DATA){
    const rec = srsGet(it.code);
    if(rec.dueTs <= t) due.push(it);
  }
  return due;
}

// Count badge updater
function updateDueBadge(){
  const el = document.getElementById('dueCount');
  if(!el) return;
  el.textContent = srsDueItems().length;
}
// --------------- Quiz ----------------
function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

function buildQuizOrder(){
  if ($("#srsMode")?.checked){
    const due = srsDueItems();
    if (due.length) return shuffle(due);
  }
  return shuffle([...DATA]);
}

let q = { i: 0, order: buildQuizOrder() };

function showQuiz(){
  if (q.i >= q.order.length){
    q.i = 0;
    q.order = buildQuizOrder();
  }
  const it = q.order[q.i % q.order.length];
  $("#qName").textContent = it.name;
  $("#qCat").textContent = it.category;
  $("#qLen").textContent = it.code.length;
  $("#qInput").value = "";
  $("#qFeedback").textContent = "";
}

function submitQuiz(){
  const it  = q.order[q.i % q.order.length];
  const val = $("#qInput").value.trim();
  const ok  = (val === it.code);

  $("#qFeedback").innerHTML = ok ? `‚úÖ Correct: ${it.code}` : `‚ùå ${val||'‚Äî'} ‚Üí ${it.code}`;

  // SRS + badge
  srsUpdate(it.code, ok);
  updateDueBadge();

  if (ok) giveFeedback?.("success"); else giveFeedback?.("error");

  STATS.seen++;
  if (ok){
    STATS.correct++;
    STATS.streak++;
    STATS.bestStreak = Math.max(STATS.bestStreak, STATS.streak);
  } else {
    STATS.streak = 0;
  }
  saveStats();
  renderStats();

  q.i++;
  showQuiz();
}

$("#qSubmit").onclick = submitQuiz;
$("#qNext").onclick   = ()=>{ q.i++; showQuiz(); };
$("#qInput").addEventListener('keydown', e=>{ if(e.key==='Enter') submitQuiz(); });

showQuiz();
updateDueBadge(); // ‚Üê make the ‚ÄúDue‚Äù chip correct on first load
 

// Initialize badge state on load
// --------------- Checkout Game ----------------
let CG = null;
const PRESETS = {
  rookie:{customers:5, maxItems:3},
  cashier:{customers:8, maxItems:6},
  speed:{customers:12, maxItems:8},
  expert:{customers:15, maxItems:12}
};
  // === Customer avatars (PNG files you uploaded to /avatars) ===
const AVATARS = [
  'avatars/avatar_01.png',
  'avatars/avatar_02.png',
  'avatars/avatar_03.png',
  'avatars/avatar_04.png',
  'avatars/avatar_05.png',
  'avatars/avatar_06.png',
  'avatars/avatar_07.png',
  'avatars/avatar_08.png',
  'avatars/avatar_09.png',
  'avatars/avatar_10.png'
];

// Simple category ‚Üí emoji icon (fallback) for belt preview
const CAT_ICON = {
  "Apple":"üçé","Pear":"üçê","Melon":"üçà","Watermelon":"üçâ","Persimmon":"üß°",
  "Quince":"üçè","Banana":"üçå","Plantain":"üçå","Peach":"üçë","Nectarine":"üçë",
  "Avocado":"ü•ë","Mango":"ü•≠","Coconut":"ü••","Papaya":"üß°","Pomegranate":"üî¥",
  "Tropical Fruit":"ü•≠","Pineapple":"üçç","Citrus":"üçã","Orange":"üçä","Mandarin":"üçä",
  "Plum":"üü£","Grapefruit":"üçä","Pomelo":"üçä","Grape":"üçá",
  "Herbs":"üåø","Herbs / Aromatics":"üåø","Leafy Greens":"ü•¨","Root Vegetable":"ü•ï",
  "Onion":"üßÖ","Garlic":"üßÑ","Potato":"ü•î","Yam":"üç†","Cabbage":"ü•¨","Brassica":"ü•¶",
  "Lettuce":"ü•¨","Stalks":"ü•¨","Asparagus":"ü•¨","Corn":"üåΩ","Beans":"ü´ò",
  "Tomato":"üçÖ","Chayote":"ü•ó","Pepper":"ü´ë","Pods":"ü´õ","Flowers / Special Veggies":"üå∫",
  "Pandan":"üåø","Pandan Leaf":"üåø","Papaya":"üß°"
};
function iconFor(it){ return CAT_ICON[it.category] || "üõí"; }

// Preload avatars to avoid flashes
(function preloadAvatars(){
  AVATARS.forEach(src=>{ const i=new Image(); i.src=src; });
})();
function startCG(){
  const p = PRESETS[$("#cgPreset").value];
  const timer = parseInt($("#cgTimer").value,10)||0;
  CG = {cust:0, custTotal:p.customers, item:0, itemTotal:0, timer, streak:0, queue:[]};
  nextCustomer();
}
function nextCustomer(){
  CG.cust++; 
  if(CG.cust > CG.custTotal){ 
    $("#cgFeedback").textContent = "üèÅ Done!"; 
    return; 
  }

  const maxItems = PRESETS[$("#cgPreset").value].maxItems;
  const n = 1 + Math.floor(Math.random() * maxItems);

  // Prefer SRS-due items when SRS is ON
  let pool;
  if ($("#srsMode")?.checked) {
    const due = srsDueItems();
    pool = due.length ? due : [...DATA];
  } else {
    pool = [...DATA];
  }

  CG.item = 0; 
  CG.itemTotal = n; 
  CG.queue = shuffle(pool).slice(0, n);

  $("#cgCust").textContent = CG.cust; 
  $("#cgCustTotal").textContent = CG.custTotal;
  nextItemCG();
}
function nextItemCG(){
  if(CG.item>=CG.itemTotal){ nextCustomer(); return; }
  const it = CG.queue[CG.item];
  $("#cgName").textContent = it.name; $("#cgCat").textContent = it.category;
  if(it.image){ $("#cgImg").src=it.image; $("#cgImg").style.display='block'; $("#cgNoImg").style.display='none'; }
  else { $("#cgImg").style.display='none'; $("#cgNoImg").style.display='inline'; }
  $("#cgItem").textContent = CG.item+1; $("#cgItemTotal").textContent = CG.itemTotal;
  $("#cgInput").value=""; $("#cgFeedback").textContent="";
  if(CG.timer>0){ startTimer(CG.timer, "#cgFeedback"); }
}
function startTimer(sec, targetSel){
  const target = $(targetSel); const start = Date.now(); const id = setInterval(()=>{
    const left = Math.max(0, sec - Math.floor((Date.now()-start)/1000));
    target.textContent = `‚è± ${left}s`;
    if(left<=0){ clearInterval(id); target.textContent = "‚è± 0s ‚Äî time!"; CG.streak=0; nextWrong(); }
  }, 200);
}
function enterCG(){
  const it  = CG.queue[CG.item];
  const val = $("#cgInput").value.trim();
  const ok  = (val === it.code);

  $("#cgFeedback").textContent = ok ? `‚úÖ ${it.code} ‚Äî +1 streak!` 
                                    : `‚ùå ${val||'‚Äî'} ‚Üí ${it.code}`;

  // SRS + badge
  srsUpdate(it.code, ok);
  updateDueBadge();

  // Haptics/sound
  if (ok) giveFeedback("success"); else giveFeedback("error");

  // Stats
  STATS.seen++;
  if (ok){ STATS.correct++; CG.streak++; } 
  else { CG.streak = 0; }
  STATS.bestStreak = Math.max(STATS.bestStreak, CG.streak);
  saveStats(); 
  renderStats();

  CG.item++; 
  setTimeout(nextItemCG, 400);
}
function skipCG(){ CG.streak=0; nextWrong(); }
function nextWrong(){ CG.item++; setTimeout(nextItemCG, 200); }
$("#cgStart").onclick = startCG;
$("#cgEnter").onclick = enterCG;
$("#cgSkip").onclick = skipCG;
$("#cgInput").addEventListener('keydown', e=>{ if(e.key==='Enter') enterCG(); });

  // --------------- SRS Badge Sync ----------------
function updateSrsBadge() {
  const badge = document.getElementById("srsBadge");
  if (!badge) return;
  if (document.getElementById("srsMode").checked) {
    badge.textContent = "ON";
    badge.classList.remove("OFF");
    badge.classList.add("ON");
  } else {
    badge.textContent = "OFF";
    badge.classList.remove("ON");
    badge.classList.add("OFF");
  }
}

// Hook into checkbox
// ---- SRS Toggle (badge + quiz rebuild + due count) ----
document.getElementById("srsMode")?.addEventListener("change", ()=>{
  updateSrsBadge();
  q = { i: 0, order: buildQuizOrder() };
  showQuiz();
  updateDueBadge();
});

// Run once on load
updateSrsBadge();

// --------------- Browse / Search + Favorites ----------------
function renderBrowse(){
  const norm = s => s.toLowerCase();
  const q = norm($("#searchBox").value.trim());
  const cat = $("#catFilter").value;
  const favOnly = $("#favOnly").checked;
  const list = $("#browseList");
  list.innerHTML = "";

  const results = DATA.filter(it => {
    const n = norm(it.name);
    const hit = n.includes(q) || it.code.includes(q) || n.replace(/\s+/g,'').includes(q);
    const catOk = !cat || it.category === cat;
    const favOk = !favOnly || FAV.has(it.code);
    return hit && catOk && favOk;
  });

  updateItemCount(results.length);

  results.forEach(it => {
    const row = document.createElement('div'); row.className='rowline';
    row.innerHTML = `
      <div style="display:flex;gap:10px;align-items:center">
        <span class="star" data-code="${it.code}">${FAV.has(it.code) ? '‚≠ê':'‚òÜ'}</span>
        <div>
          <div><b>${it.name}</b> <span class="muted small">(${it.category})</span></div>
          <div class="small muted">${it.code}${it.notes? ' ‚Äî '+it.notes:''}</div>
        </div>
      </div>
      <div class="imgbox">${it.image? `<img src="${it.image}">`:`<span class="muted small">No picture</span>`}</div>`;
    list.appendChild(row);
  });

  $$('.star').forEach(s => s.onclick = () => {
    const c = s.dataset.code;
    if(FAV.has(c)) FAV.delete(c); else FAV.add(c);
    saveFav(); renderBrowse();
  });
}
function buildCatFilter(){
  const cats = Array.from(new Set(DATA.map(d=>d.category))).sort();
  $("#catFilter").innerHTML = `<option value="">All Categories</option>` + cats.map(c=>`<option>${c}</option>`).join('');
}
$("#searchBox").oninput = renderBrowse;
$("#catFilter").onchange = renderBrowse;
$("#favOnly").onchange = renderBrowse;
buildCatFilter();
renderBrowse();
updateItemCount(); // initial (e.g. 168/168)

// --------------- Big Keypad ----------------
// number keys:
$$('.bigkey').forEach(k=>{
  const v = k.textContent.trim();
  if(/^\d$/.test(v)) k.onclick = ()=>{
    $("#bkInput").value += v;
    giveFeedback("light"); // ADD (tiny tap feedback)
  };
});

// enter:
$("#bkEnter").onclick = ()=>{
  const code = $("#bkInput").value.trim();
  const hit = DATA.find(d=>d.code===code);
  $("#bkFeedback").textContent = hit ? `‚úÖ ${hit.name} (${hit.category})` : `‚ùå Not found`;

  // ADD:
  if (hit) giveFeedback("success"); else giveFeedback("error");
};

// clear:
$("#bkClear").onclick = ()=>{
  $("#bkInput").value="";
  $("#bkFeedback").textContent="";
  giveFeedback("light"); // ADD
};
// --------------- Stats ----------------
function renderStats(){
  const acc = accuracyPct(STATS);
  $("#stats").innerHTML = `
    <div class="row" style="align-items:flex-end; gap:12px">
      <div class="card" style="flex:1; padding:10px">
        <div class="muted small">Seen</div>
        <div style="font-size:1.4rem;font-weight:700">${fmt(STATS.seen)}</div>
      </div>
      <div class="card" style="flex:1; padding:10px">
        <div class="muted small">Correct</div>
        <div style="font-size:1.4rem;font-weight:700">${fmt(STATS.correct)}</div>
      </div>
      <div class="card" style="flex:1; padding:10px">
        <div class="muted small">Accuracy</div>
        <div style="font-size:1.4rem;font-weight:700">${acc}%</div>
      </div>
      <div class="card" style="flex:1; padding:10px">
        <div class="muted small">Streak</div>
        <div style="font-size:1.4rem;font-weight:700">${fmt(STATS.streak)}</div>
      </div>
      <div class="card" style="flex:1; padding:10px">
        <div class="muted small">Best</div>
        <div style="font-size:1.4rem;font-weight:700">${fmt(STATS.bestStreak)}</div>
      </div>
    </div>
  `;
}
renderStats();
// ---------- Export / Share ----------
function buildBackupPayload(){
  return {
    when: new Date().toISOString(),
    version: 1,
    data: DATA,        // full PLU dataset
    fav: [...FAV],     // starred codes
    stats: STATS       // seen/correct/streaks
  };
}

// üíæ Save Backup ‚Äî full data as JSON file
$("#exportData")?.addEventListener('click', ()=>{
  const blob = new Blob([JSON.stringify(buildBackupPayload(), null, 2)], {type:'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'plu_trainer_backup.json';
  a.click();
  setTimeout(()=>URL.revokeObjectURL(a.href), 1000);
});

// üì§ Share Stats ‚Äî pretty text + tiny JSON (with fallbacks)
$("#shareStats")?.addEventListener('click', async ()=>{
  const text = prettyStatsText();
  const json = JSON.stringify({
    when: new Date().toISOString(),
    version: 1,
    stats: STATS,
    accuracy: accuracyPct(STATS) + "%"
  }, null, 2);

  const file = new File([json], 'plu_trainer_stats.json', {type:'application/json'});

  // Try Share Sheet with text + file
  try {
    if (navigator.canShare && navigator.canShare({ files:[file] })) {
      await navigator.share({ title:'PLU Trainer Stats', text, files:[file] });
      return;
    }
  } catch(e){ /* user canceled */ }

  // Try Share Sheet with text only
  try {
    if (navigator.share) {
      await navigator.share({ title:'PLU Trainer Stats', text });
      return;
    }
  } catch(e){ /* fall through */ }

  // Fallback #1: copy text
  try {
    await navigator.clipboard.writeText(text);
    alert("Stats copied to clipboard. Paste into Messages/Email.");
  } catch(e) {
    // Fallback #2: download .txt
    const blob = new Blob([text], {type:'text/plain'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'plu_trainer_stats.txt';
    a.click();
    setTimeout(()=>URL.revokeObjectURL(a.href), 1000);
  }
});
// --- First-time onboarding tip
if (!localStorage.getItem('ONBOARDED')) {
alert('Tip: Use Browse to ‚≠ê favorite tricky items, then practice in Quiz or Checkout.');
  localStorage.setItem('ONBOARDED','1');
}
</script>
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js');
  }
</script>
</body>
</html>
